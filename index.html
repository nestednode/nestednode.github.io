<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=1140">
<link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400,300&subset=latin,cyrillic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Roboto+Mono:400&subset=latin,cyrillic' rel='stylesheet' type='text/css'><link rel="stylesheet" href="index.css"><title>NestedNode</title></head><body><div class="header"><div class="header__title"><div class="nn-logo"><div class="nn-logo__part1">Nested</div><div class="nn-logo__part2">Node</div></div></div><div class="header__descr">Расширяемый редактор<br>
древовидных структур данных
</div></div><div class="demo"><div class="demo__editor-box"></div><div class="demo__keymap-box"><div class="keymap"><div class="keymap__entry-group"><div class="keymap__entry"><div class="keymap__shortcut"><div class="keymap__shortcut-box"><div class="key key_left"></div></div><div class="keymap__shortcut-box keymap__shortcut-box_with-margin"><div class="key key_top"></div><br><div class="key key_bottom"></div></div><div class="keymap__shortcut-box"><div class="key key_right"></div></div></div><div class="keymap__descr">выбрать узел:<div class="keymap__sub-descr"><div class="keymap__sub-descr-item">родительский</div><div class="keymap__sub-descr-item">предыдущий<br>следующий</div><div class="keymap__sub-descr-item">вложенный</div></div></div></div><div class="keymap__entry"><div class="keymap__shortcut"><div class="key key_shift"></div><div class="keymap__shortcut-box"><div class="key key_top"></div><br><div class="key key_bottom"></div></div></div><div class="keymap__descr">добавить<div class="keymap__sub-descr"><div class="keymap__sub-descr-item">предыдущий<br>следующий</div></div>к выбранному</div></div><div class="keymap__entry"><div class="keymap__shortcut"><div class="key key_ctrl"></div><div class="key key_a"></div></div><div class="keymap__descr">выбрать все соседние узлы</div></div></div><div class="keymap__entry-group keymap__entry-group_compact"><div class="keymap__entry keymap__entry_inline"><div class="keymap__shortcut"><div class="key key_space"></div></div><div class="keymap__descr">редактировать</div></div><div class="keymap__sub-entry-box"><div class="keymap__entry"><div class="keymap__shortcut"><div class="key key_esc"></div></div><div class="keymap__descr">отменить ввод</div></div><div class="keymap__entry"><div class="keymap__shortcut"><div class="key key_return"></div></div><div class="keymap__descr">подтвердить</div></div></div></div><div class="keymap__column"><div class="keymap__entry-group"><div class="keymap__entry"><div class="keymap__shortcut"><div class="key key_tab"></div></div><div class="keymap__descr">добавить внутрь</div></div><div class="keymap__entry"><div class="keymap__shortcut"><div class="key key_shift"></div><div class="key key_tab"></div></div><div class="keymap__descr">обернуть</div></div><div class="keymap__entry"><div class="keymap__shortcut"><div class="key key_return"></div></div><div class="keymap__descr">добавить после</div></div><div class="keymap__entry"><div class="keymap__shortcut"><div class="key key_shift"></div><div class="key key_return"></div></div><div class="keymap__descr">добавить перед</div></div><div class="keymap__entry"><div class="keymap__shortcut"><div class="key key_alt"></div><div class="keymap__shortcut-box"><div class="key key_top"></div><br><div class="key key_bottom"></div></div></div><div class="keymap__descr">поместить<div class="keymap__sub-descr"><div class="keymap__sub-descr-item">перед<br>после</div></div></div></div><div class="keymap__entry"><div class="keymap__shortcut"><div class="key key_ctrl"></div><div class="key key_d"></div></div><div class="keymap__descr">дублировать</div></div><div class="keymap__entry"><div class="keymap__shortcut"><div class="key key_delete"></div></div><div class="keymap__descr">удалить</div></div></div></div><div class="keymap__column"><div class="keymap__entry-group"><div class="keymap__entry keymap__entry_compact"><div class="keymap__shortcut"><div class="key key_ctrl"></div><div class="key key_x"></div></div><br><div class="keymap__descr">вырезать</div></div><br><div class="keymap__entry keymap__entry_compact"><div class="keymap__shortcut"><div class="key key_ctrl"></div><div class="key key_c"></div></div><br><div class="keymap__descr">копировать</div></div><br><div class="keymap__entry keymap__entry_compact"><div class="keymap__shortcut"><div class="key key_ctrl"></div><div class="key key_v"></div></div><br><div class="keymap__descr">вставить</div></div></div><div class="keymap__entry-group"><div class="keymap__entry keymap__entry_compact"><div class="keymap__shortcut"><div class="key key_ctrl"></div><div class="key key_z"></div></div><br><div class="keymap__descr">отменить</div></div><br><div class="keymap__entry keymap__entry_compact"><div class="keymap__shortcut"><div class="key key_ctrl"></div><div class="key key_y"></div></div><br><div class="keymap__descr">вернуть</div></div></div></div></div></div></div><div class="info"><div class="info__box"><div class="pkg"><div class="pkg__install-cmd">bower install nn-nested-node</div><div class="pkg__descr pkg__descr_compact">пакет с&#160;базовыми компонентами для&#160;построения редактора под&#160;требуемый
тип&#160;узлов</div><a href="https://github.com/nestednode/nn-nested-node" class="pkg__repo-link">GitHub</a></div><div class="pkg"><div class="pkg__inherits"></div><div class="pkg__install-cmd">bower install nn-nested-text</div><div class="pkg__descr">редактор вложенных текстовых&#160;узлов</div><a href="https://github.com/nestednode/nn-nested-text" class="pkg__repo-link">GitHub</a></div></div><div class="info__box"><div class="info__item">Язык программирования — <em class='info__em'>TypeScript</em></div><div class="info__item">Пользовательский интерфейс — <em class='info__em'>React</em>-компоненты</div><div class="info__item">Модули — <em class='info__em'>AMD</em></div><div class="info__item">Пакеты — <em class='info__em'>Bower</em></div><div class="info__item">Сборщик — <em class='info__em'>Gulp</em></div></div><div class="info__box-clear"></div></div><div class="code"><!--<meta name="Generator" content="Cocoa HTML Writer">-->
// Как построить редактор под требуемый тип узлов:<br>
<br>
// определяем, данные какой структуры будут редактироваться в узлах документа —<br>
// для простоты примера, пусть это будет текстовая строка<br>
<br>
<span class="s2">export interface </span><span class="s1">TextData {<br>
<span>    </span></span><span class="s3">text</span><span class="s1">: </span><span class="s2">string</span><span class="s1">;<br>
}<br>
<br>
<br>
</span>// реализуем набор функций над этими данными,<br>
// они необходимы для работы внутренних методов документа<br>
<br>
<span class="s2">export var </span><span class="s3">TextDataFunctions</span><span class="s1">: <a href="https://github.com/nestednode/nn-nested-node/blob/master/src/NestedNode/DataFunctions.ts">DataFunctions</a>&lt;TextData&gt; = {<br>
<br>
<span>    </span></span><span class="s4">getBlank</span><span class="s1">: () =&gt; ({ </span><span class="s3">text</span><span class="s1">: </span><span class="s5">'' </span><span class="s1">}),<br>
<br>
<span>    </span></span><span class="s4">isBlank</span><span class="s1">: (data: TextData) =&gt; data.</span><span class="s3">text </span><span class="s1">== </span><span class="s5">''</span><span class="s1">,<br>
<br>
<span>    </span></span><span class="s4">isEqual</span><span class="s1">: (data1: TextData, data2: TextData) =&gt; data1.</span><span class="s3">text </span><span class="s1">== data2.</span><span class="s3">text</span><span class="s1">.</span><span class="s4">trim</span><span class="s1">(),<br>
<br>
<span>    </span></span><span class="s4">duplicate</span><span class="s1">: (data: TextData) =&gt; ({ </span><span class="s3">text</span><span class="s1">: data.</span><span class="s3">text </span><span class="s1">})<br>
};<br>
<br>
<br>
</span>// предыдущего достаточно, чтобы получить документ, работающий с деревом узлов нужного нам типа<br>
<br>
<span class="s2">export function </span><span class="s1">createDocument(content: <a href="https://github.com/nestednode/nn-nested-node/blob/master/src/NestedNodeProps/NestedNodeProps.ts">NestedNodeProps</a>&lt;TextData&gt;): NNDocument&lt;TextData&gt; {<br>
<span>    </span></span><span class="s2">return new <a href="https://github.com/nestednode/nn-nested-node/blob/master/src/NestedNode/NNDocument.ts">NNDocument</a></span><span class="s1">&lt;TextData&gt;(content, </span><span class="s3">TextDataFunctions</span><span class="s1">);<br>
}<br>
<br>
<br>
</span>// переходим к View: опеределяем React-компонент, который будет отображать данные узла,<br>
// отвечать за их редактирование, а также интерперетировать действия пользователя<br>
// в вызовы соответствующих операций над документом<br>
<br>
<span class="s2">export class </span><span class="s1">NestedTextNodeViewComponent </span><span class="s2">extends <a href="https://github.com/nestednode/nn-nested-node/blob/master/src/NestedNodeView/NestedNodeView.ts">NestedNodeView</a></span><span class="s1">.Component&lt;TextData&gt; {<br>
<br>
<span>    </span></span><span class="s2">protected </span><span class="s4">renderData</span><span class="s1">(data: TextData, editMode: </span><span class="s2">boolean</span><span class="s1">) {<br>
<span>        </span></span><span class="s2">var </span><span class="s6">dataCls </span><span class="s1">= </span><span class="s5">'nn__node-data'</span><span class="s1">;<br>
<span>        </span></span><span class="s2">return </span><span class="s1">editMode ?<br>
<span>            </span><a href="https://github.com/nestednode/nn-nested-text/blob/master/src/TextInputComponent.ts">TextInputComponent</a>.Element({<br>
<span>                </span></span><span class="s3">className</span><span class="s1">: </span><span class="s6">dataCls</span><span class="s1">,<br>
<span>                </span></span><span class="s3">value</span><span class="s1">: data.</span><span class="s3">text</span><span class="s1">,<br>
<span>                </span></span><span class="s3">onChange</span><span class="s1">: </span><span class="s2">this</span><span class="s1">.</span><span class="s4">handleTextChange</span><span class="s1">.</span><span class="s4">bind</span><span class="s1">(</span><span class="s2">this</span><span class="s1">),<br>
<span>                </span></span><span class="s3">onBlur</span><span class="s1">: </span><span class="s2">this</span><span class="s1">.</span><span class="s4">handleTextBlur</span><span class="s1">.</span><span class="s4">bind</span><span class="s1">(</span><span class="s2">this</span><span class="s1">)<br>
<span>            </span>}) :<br>
<span>            </span>React.DOM[</span><span class="s5">'div'</span><span class="s1">]({ </span><span class="s3">className</span><span class="s1">: </span><span class="s6">dataCls </span><span class="s1">}, data.</span><span class="s3">text</span><span class="s1">);<br>
<span>    </span>}<br>
<br>
<span>    </span></span><span class="s2">private </span><span class="s4">handleTextChange</span><span class="s1">(value: </span><span class="s2">string</span><span class="s1">) {<br>
<span>        </span></span><span class="s2">this</span><span class="s1">.</span><span class="s3">context</span><span class="s1">.<a href="https://github.com/nestednode/nn-nested-node/blob/master/src/NestedNodeProps/NNDocumentActions.ts">documentActions</a>.</span><span class="s4">updateNodeData</span><span class="s1">({ </span><span class="s3">text</span><span class="s1">: value });<br>
<span>    </span>}<br>
<br>
<span>    </span></span><span class="s2">private </span><span class="s4">handleTextBlur</span><span class="s1">() {<br>
<span>        </span></span><span class="s2">this</span><span class="s1">.</span><span class="s3">context</span><span class="s1">.</span><span class="s3">documentActions</span><span class="s1">.</span><span class="s4">exitEditMode</span><span class="s1">();<br>
<span>    </span>}<br>
<br>
<span>    </span></span><span class="s2">protected </span><span class="s4">handleKeyPress</span><span class="s1">(e: KeyboardEvent) {<br>
<span>        </span></span><span class="s2">if </span><span class="s1">(</span><span class="s2">this</span><span class="s1">.</span><span class="s3">props</span><span class="s1">.</span><span class="s3">editing</span><span class="s1">) {<br>
<span>            </span></span><span class="s2">return</span><span class="s1">;<br>
<span>        </span>}<br>
<span>        </span></span><span class="s2">if </span><span class="s1">(e.</span><span class="s3">ctrlKey </span><span class="s1">|| e.</span><span class="s3">metaKey </span><span class="s1">|| e.</span><span class="s3">altKey </span><span class="s1">|| e.</span><span class="s3">charCode </span><span class="s1">== KeyboardUtil.</span><span class="s3">KeyCode</span><span class="s1">.</span><span class="s3">SPACE</span><span class="s1">) {<br>
<span>            </span></span><span class="s2">return</span><span class="s1">;<br>
<span>        </span>}<br>
</span><span>        </span><span class="s1">e.</span><span class="s4">preventDefault</span><span class="s1">();<br>
<span>        </span></span><span class="s2">this</span><span class="s1">.</span><span class="s3">context</span><span class="s1">.</span><span class="s3">documentActions</span><span class="s1">.</span><span class="s4">enterEditMode</span><span class="s1">({ </span><span class="s3">text</span><span class="s1">: e.</span><span class="s3">key </span><span class="s1">});<br>
<span>    </span>}<br>
}<br>
<br>
<br>
</span>// после того как компонент для работы с отдельными узлами готов,<br>
// React-элемент для всего документа создается следующим образом:<br>
<br>
<span class="s2">export function </span><span class="s1">createDocumentViewElement(document: NNDocument&lt;TextData&gt;, styleMods): React.ReactElement {<br>
<span>    </span></span><span class="s2">return <a href="https://github.com/nestednode/nn-nested-node/blob/master/src/NestedNodeView/NNDocumentView.ts">NNDocumentView</a></span><span class="s1">.Element&lt;TextData&gt;({<br>
<span>        </span></span><span class="s3">documentActions</span><span class="s1">: document,<br>
<span>        </span><a href="https://github.com/nestednode/nn-nested-node/blob/master/src/NestedNodeProps/NNDocumentProps.ts">documentProps</a>: document,<br>
<span>        </span></span><span class="s3">nestedNodeViewComponent</span><span class="s1">: NestedTextNodeViewComponent,<br>
<span>        </span></span><span class="s3">styleMods</span><span class="s1">: styleMods<br>
<span>    </span>})<br>
}<br>
<br>
<br>
</span>// теперь дело за React (см. также <a href="https://github.com/nestednode/nn-nested-text/blob/master/labs/demo/demo.js">demo.js</a>)<br>
<br>
<span class="s2">export function </span><span class="s1">renderToContainer(container: Element, styleMods, document: NNDocument&lt;TextData&gt;) {<br>
<span>    </span></span><span class="s2">return </span><span class="s1">React.render(createDocumentViewElement(document, styleMods), container);<br>
}<br>
</span>
</div><div class="footer"><div class="footer__text"><a href="https://www.flickr.com/photos/asphericlens/4448352145/" class="footer__link"><img src="img/tree-orig-preview.jpg" class="footer__img"></a><div class="footer__p">В&#160;оформлении использована работа
«<a class="footer__link" href='https://www.flickr.com/photos/asphericlens/4448352145/'>single&#160;tree</a>»
(автор фотографии <a class="footer__link" href='https://www.flickr.com/people/asphericlens/'>skoeber</a>,
лицензия <a class="footer__link" href='https://creativecommons.org/licenses/by-nc-sa/2.0/'>CC BY-NC-SA 2.0</a>).</div><div class="footer__p">Исходное изображение было модифицировано: повернуто на&#160;90°, кадрировано
и&#160;применено в&#160;качестве фона для&#160;заглавия сайта.</div><div class="footer__p"></div></div></div><script src="bundle.js"></script></body></html>